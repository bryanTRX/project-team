<div class="chatbot-container">
  <div class="chatbot-widget" [class.open]="isOpen">
    <div class="chatbot-header">
      <div class="chatbot-header-content" (click)="toggleChat()">
        <div class="chatbot-avatar">
          <i class="fas fa-comments"></i>
        </div>
      </div>
      <button
        *ngIf="isOpen"
        class="chatbot-toggle"
        (click)="toggleChat(); $event.stopPropagation()"
        [attr.aria-label]="getTranslation('close_chat', currentLanguage) || 'Close chat'"
      >
        <i class="fas fa-chevron-down"></i>
      </button>
    </div>

    <div class="chatbot-body" *ngIf="isOpen">
      <div class="chat-messages">
        <div
          *ngFor="let message of messages; let i = index"
          class="message"
          [class.user-message]="message.isUser"
          [class.bot-message]="!message.isUser"
        >
          <div class="message-content">
            <div class="message-header" *ngIf="!message.isUser">
              <p>{{ message.text }}</p>
              <button
                *ngIf="speechSynthesis"
                class="speech-btn"
                (click)="toggleSpeech(i, message.text)"
                [attr.aria-label]="
                  isPaused(i)
                    ? getTranslation('speech_play', currentLanguage)
                    : isSpeaking(i)
                      ? getTranslation('speech_pause', currentLanguage)
                      : getTranslation('speech_play', currentLanguage)
                "
                [title]="
                  isPaused(i)
                    ? getTranslation('speech_play', currentLanguage)
                    : isSpeaking(i)
                      ? getTranslation('speech_pause', currentLanguage)
                      : getTranslation('speech_play', currentLanguage)
                "
              >
                <i
                  class="fas"
                  [class.fa-play]="!isSpeaking(i) || isPaused(i)"
                  [class.fa-pause]="isSpeaking(i) && !isPaused(i)"
                ></i>
              </button>
            </div>
            <p *ngIf="message.isUser">{{ message.text }}</p>
            <div
              *ngIf="message.quickActions && message.quickActions.length > 0"
              class="quick-actions"
            >
              <button
                *ngFor="let action of message.quickActions"
                class="quick-action-btn"
                (click)="executeAction(action.action)"
                [attr.aria-label]="action.label"
              >
                <i *ngIf="action.icon" [class]="'fas fa-' + action.icon"></i>
                <span>{{ action.label }}</span>
              </button>
            </div>
          </div>
        </div>
        <div *ngIf="isTyping" class="message bot-message typing-indicator">
          <div class="message-content">
            <div class="typing-dots">
              <span></span>
              <span></span>
              <span></span>
            </div>
          </div>
        </div>
      </div>

      <div class="chat-input-container">
        <button
          class="chat-share-btn"
          (click)="shareConversation()"
          [attr.aria-label]="getTranslation('share_conversation', currentLanguage)"
          [title]="getTranslation('share_conversation', currentLanguage)"
        >
          <i class="fas fa-share-alt"></i>
        </button>
        <input
          type="text"
          class="chat-input"
          [(ngModel)]="userInput"
          (keyup.enter)="sendMessage()"
          [placeholder]="getTranslation('chatbot_placeholder', currentLanguage)"
          autocomplete="off"
        />
        <button
          class="chat-send-btn"
          (click)="sendMessage()"
          [disabled]="!userInput.trim() || isTyping"
        >
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>
    </div>
  </div>
</div>
