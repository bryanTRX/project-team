<section class="payment-section">
  <div class="container">
    <ng-container *ngIf="!showSuccess; else successState">
      <div class="payment-card" [ngClass]="{'text-large': textSize === 'large', 'text-xlarge': textSize === 'xlarge'}">
        <div class="form-intro">
          <div class="org-brand">
            <div class="brand-icon">
              <i class="fas fa-heart"></i>
            </div>
            <div>
              <p class="brand-name">Haven of Hope</p>
              <p class="brand-support">
                Supporting women and children on their journey to safety, healing, and new beginnings
              </p>
            </div>
          </div>
          <button class="accessibility-btn" type="button" (click)="toggleAccessibilityPanel()">
            <i class="fas fa-universal-access"></i>
            <span>Accessibility Settings</span>
          </button>
        </div>
        <div class="accessibility-panel" *ngIf="showAccessibilityPanel">
          <div class="panel-row">
            <div>
              <p class="panel-title">Simple Mode</p>
              <span class="panel-subtitle">Show only essential information</span>
            </div>
            <label class="toggle-switch">
              <input
                type="checkbox"
                name="simpleMode"
                [(ngModel)]="simpleMode"
                (change)="trackSimpleModeChange()">
              <span class="slider"></span>
            </label>
          </div>
          <div class="panel-row">
            <div class="panel-label">
              <i class="fas fa-text-height"></i>
              <span>Text Size</span>
            </div>
            <select [(ngModel)]="textSize" name="textSize">
              <option *ngFor="let option of textSizeOptions" [value]="option.value">
                {{ option.label }}
              </option>
            </select>
          </div>
        </div>

        <div class="form-headline">
          <h1>Make a Difference Today</h1>
          <p>Your generosity provides safety, support, and hope for those who need it most.</p>
        </div>

        <form (ngSubmit)="onSubmit()" class="donation-form">
          <div class="form-section email-section">
            <label for="email">Email Address</label>
            <div class="input-with-icon">
              <i class="fas fa-envelope"></i>
              <input
                type="email"
                id="email"
                [(ngModel)]="email"
                name="email"
                placeholder="your.email@example.com"
                required>
            </div>
            <p class="field-hint">
              We'll use this to send you a donation receipt and optional updates.
            </p>
            <p class="field-example" *ngIf="!simpleMode">
              Try: user@existing.com (has account) or user@new.com (new donor)
            </p>
          </div>

          <div class="form-section amount-section">
            <label>Choose Your Donation Amount</label>
            <div class="amount-options">
              <button
                type="button"
                *ngFor="let option of donationOptions"
                (click)="selectDonationAmount(option)"
                [class.active]="donationAmount === option && !customAmount">
                {{ option | currency:'USD':'symbol':'1.0-0' }}
              </button>
            </div>
            <div class="custom-amount">
              <label for="customAmount">Or enter a custom amount</label>
              <div class="custom-input">
                <span class="currency-symbol">$</span>
                <input
                  type="number"
                  id="customAmount"
                  name="customAmount"
                  min="1"
                  step="1"
                  placeholder="0.00"
                  [(ngModel)]="customAmount"
                  (input)="onCustomAmountChange()">
              </div>
            </div>
          </div>

          <div class="form-section frequency-section">
            <label>Donation Frequency</label>
            <div class="frequency-options">
              <button
                type="button"
                class="frequency-card"
                *ngFor="let option of frequencyOptions"
                (click)="selectFrequency(option.value)"
                [class.active]="recurringOption === option.value">
                <div class="freq-header">
                  <span class="freq-label">{{ option.label }}</span>
                  <span class="freq-badge" *ngIf="option.highlight">{{ option.highlight }}</span>
                </div>
                <span class="freq-description">{{ option.description }}</span>
              </button>
            </div>
          </div>

          <div class="info-card impact-card" *ngIf="!simpleMode">
            <div class="info-icon">
              <i class="fas fa-hands-helping"></i>
            </div>
            <div>
              <p class="info-title">Monthly Giving Creates Lasting Impact</p>
              <p class="info-description">
                Recurring donations help us plan long-term programs, provide consistent support, and build
                sustainable resources for women and children rebuilding their lives.
              </p>
            </div>
          </div>

          <div class="info-card updates-card" *ngIf="!simpleMode">
            <div class="info-icon">
              <i class="fas fa-newspaper"></i>
            </div>
            <div class="updates-content">
              <div>
                <p class="info-title">Stay Connected with Your Impact</p>
                <p class="info-description">
                  Receive heartwarming stories, see how your donation makes a difference, and get updates on
                  the lives you're helping to change.
                </p>
              </div>
              <label class="checkbox-field">
                <input
                  type="checkbox"
                  [(ngModel)]="updatesOptIn"
                  name="updatesOptIn">
                <span>Yes, I'd like to receive impact updates and newsletters</span>
              </label>
            </div>
          </div>

          <div class="privacy-card" *ngIf="!simpleMode">
            <i class="fas fa-lock"></i>
            <div>
              <p class="privacy-title">Your privacy matters.</p>
              <p>We never share your information. You can unsubscribe anytime with one click.</p>
            </div>
          </div>

          <div class="form-section payment-method-section">
            <label>Payment Method</label>
            <div class="payment-methods">
              <button
                type="button"
                *ngFor="let method of paymentMethods"
                (click)="selectPaymentMethod(method.value)"
                [class.active]="selectedPaymentMethod === method.value">
                <div class="method-header">
                  <i [class]="method.icon"></i>
                  <span>{{ method.label }}</span>
                </div>
                <div class="method-badges">
                  <span *ngFor="let badge of method.badges">{{ badge }}</span>
                </div>
              </button>
            </div>
          </div>

          <div class="form-section card-details" *ngIf="selectedPaymentMethod === 'card'">
            <label>Payment Information</label>
            <div class="form-group">
              <label for="cardNumber">Card Number</label>
              <input
                type="text"
                id="cardNumber"
                [(ngModel)]="cardNumber"
                name="cardNumber"
                placeholder="1234 5678 9012 3456"
                (input)="formatCardNumber()"
                maxlength="19"
                required>
            </div>

            <div class="form-group">
              <label for="cardHolder">Card Holder Name</label>
              <input
                type="text"
                id="cardHolder"
                [(ngModel)]="cardHolder"
                name="cardHolder"
                placeholder="John Doe"
                required>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="expiryDate">Expiry Date</label>
                <input
                  type="text"
                  id="expiryDate"
                  [(ngModel)]="expiryDate"
                  name="expiryDate"
                  placeholder="MM/YY"
                  (input)="formatExpiryDate()"
                  maxlength="5"
                  required>
              </div>

              <div class="form-group">
                <label for="cvv">CVV</label>
                <input
                  type="text"
                  id="cvv"
                  [(ngModel)]="cvv"
                  name="cvv"
                  placeholder="123"
                  (input)="formatCvv()"
                  maxlength="4"
                  required>
              </div>
            </div>
          </div>

          <div class="security-info">
            <i class="fas fa-shield-alt"></i>
            <div>
              <p>Your donation is secure and tax-deductible. EIN: XX-XXXXXXX</p>
              <span>All information is kept confidential and secure.</span>
            </div>
          </div>

          <button type="submit" class="submit-payment-btn">
            <i class="fas fa-heart"></i>
            <span>Complete Donation</span>
          </button>
        </form>
      </div>
    </ng-container>

    <ng-template #successState>
      <div class="success-message">
        <div class="success-icon">
          <i class="fas fa-check-circle"></i>
        </div>
        <h2>Thank You!</h2>
        <p>Your donation of ${{ donationAmount }} has been processed successfully.</p>
        <p>You will receive a confirmation email shortly.</p>
        <div class="success-animation">
          <i class="fas fa-heart"></i>
        </div>
        <button class="back-btn" (click)="goBack()">Return Home</button>
      </div>
    </ng-template>
  </div>
</section>
