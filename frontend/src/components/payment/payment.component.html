<section class="payment-section">
  <div class="container">
    <ng-container *ngIf="!showSuccess; else successState">
      <div class="payment-card" [ngClass]="{'text-large': textSize === 'large', 'text-xlarge': textSize === 'xlarge'}">
        <div class="form-intro">
          <div class="org-brand">
            <div class="brand-icon">
              <i class="fas fa-heart"></i>
            </div>
            <div>
              <p class="brand-name">Haven of Hope</p>
              <p class="brand-support">
                {{ languageService.getTranslation('supporting_women_children') }}
              </p>
            </div>
          </div>
          <button class="accessibility-btn" type="button" (click)="toggleAccessibilityPanel()">
            <i class="fas fa-universal-access"></i>
            <span>{{ languageService.getTranslation('accessibility_settings') }}</span>
          </button>
        </div>
        <div class="accessibility-panel" *ngIf="showAccessibilityPanel">
          <div class="panel-row">
            <div>
              <p class="panel-title">{{ languageService.getTranslation('simple_mode') }}</p>
              <span class="panel-subtitle">{{ languageService.getTranslation('show_only_essential') }}</span>
            </div>
            <label class="toggle-switch">
              <input
                type="checkbox"
                name="simpleMode"
                [(ngModel)]="simpleMode"
                (change)="trackSimpleModeChange()">
              <span class="slider"></span>
            </label>
          </div>
          <div class="panel-row">
            <div class="panel-label">
              <i class="fas fa-text-height"></i>
              <span>{{ languageService.getTranslation('text_size') }}</span>
            </div>
            <select [(ngModel)]="textSize" name="textSize">
              <option *ngFor="let option of textSizeOptions" [value]="option.value">
                {{ option.label }}
              </option>
            </select>
          </div>
        </div>

        <div class="form-headline">
          <h1>{{ languageService.getTranslation('make_difference_today_payment') }}</h1>
          <p>{{ languageService.getTranslation('generosity_provides_safety') }}</p>
        </div>

        <form (ngSubmit)="onSubmit()" class="donation-form">
          <div class="form-section email-section">
            <label for="email">{{ languageService.getTranslation('email_address') }}</label>
            <div class="input-with-icon">
              <i class="fas fa-envelope"></i>
              <input
                type="email"
                id="email"
                [(ngModel)]="email"
                name="email"
                placeholder="your.email@example.com"
                required>
            </div>
            <p class="field-hint">
              {{ languageService.getTranslation('we_use_email_for_receipt') }}
            </p>
            <p class="field-example" *ngIf="!simpleMode">
              {{ languageService.getTranslation('try_email_examples') }}
            </p>
          </div>

          <div class="form-section amount-section">
            <label>{{ languageService.getTranslation('choose_donation_amount') }}</label>
            <div class="amount-options">
              <button
                type="button"
                *ngFor="let option of donationOptions"
                (click)="selectDonationAmount(option)"
                [class.active]="donationAmount === option && !customAmount">
                {{ option | currency:'USD':'symbol':'1.0-0' }}
              </button>
            </div>
            <div class="custom-amount">
              <label for="customAmount">{{ languageService.getTranslation('or_enter_custom_amount') }}</label>
              <div class="custom-input">
                <span class="currency-symbol">$</span>
                <input
                  type="number"
                  id="customAmount"
                  name="customAmount"
                  min="1"
                  step="1"
                  placeholder="0.00"
                  [(ngModel)]="customAmount"
                  (input)="onCustomAmountChange()">
              </div>
            </div>
          </div>

          <div class="form-section frequency-section">
            <label>{{ languageService.getTranslation('donation_frequency') }}</label>
            <div class="frequency-options">
              <button
                type="button"
                class="frequency-card"
                *ngFor="let option of frequencyOptions"
                (click)="selectFrequency(option.value)"
                [class.active]="recurringOption === option.value">
                <div class="freq-header">
                  <span class="freq-label">{{ option.label }}</span>
                  <span class="freq-badge" *ngIf="option.highlight">{{ option.highlight }}</span>
                </div>
                <span class="freq-description">{{ option.description }}</span>
              </button>
            </div>
          </div>

          <div class="info-card impact-card" *ngIf="!simpleMode">
            <div class="info-icon">
              <i class="fas fa-hands-helping"></i>
            </div>
            <div>
              <p class="info-title">{{ languageService.getTranslation('monthly_giving_creates_impact') }}</p>
              <p class="info-description">
                {{ languageService.getTranslation('recurring_helps_plan') }}
              </p>
            </div>
          </div>

          <div class="info-card updates-card" *ngIf="!simpleMode">
            <div class="info-icon">
              <i class="fas fa-newspaper"></i>
            </div>
            <div class="updates-content">
              <div>
                <p class="info-title">{{ languageService.getTranslation('stay_connected_impact') }}</p>
                <p class="info-description">
                  {{ languageService.getTranslation('receive_stories_updates') }}
                </p>
              </div>
              <label class="checkbox-field">
                <input
                  type="checkbox"
                  [(ngModel)]="updatesOptIn"
                  name="updatesOptIn">
                <span>{{ languageService.getTranslation('yes_receive_updates') }}</span>
              </label>
            </div>
          </div>

          <div class="privacy-card" *ngIf="!simpleMode">
            <i class="fas fa-lock"></i>
            <div>
              <p class="privacy-title">{{ languageService.getTranslation('your_privacy_matters') }}</p>
              <p>{{ languageService.getTranslation('never_share_info') }}</p>
            </div>
          </div>

          <div class="form-section payment-method-section">
            <label>{{ languageService.getTranslation('payment_method') }}</label>
            <div class="payment-methods">
              <button
                type="button"
                *ngFor="let method of paymentMethods"
                (click)="selectPaymentMethod(method.value)"
                [class.active]="selectedPaymentMethod === method.value">
                <div class="method-header">
                  <i [class]="method.icon"></i>
                  <span>{{ method.label }}</span>
                </div>
                <div class="method-badges">
                  <span *ngFor="let badge of method.badges">{{ badge }}</span>
                </div>
              </button>
            </div>
          </div>

          <div class="form-section card-details" *ngIf="selectedPaymentMethod === 'card'">
            <label>{{ languageService.getTranslation('payment_information') }}</label>
            <div class="form-group">
              <label for="cardNumber">{{ languageService.getTranslation('card_number') }}</label>
              <input
                type="text"
                id="cardNumber"
                [(ngModel)]="cardNumber"
                name="cardNumber"
                placeholder="1234 5678 9012 3456"
                (input)="formatCardNumber()"
                maxlength="19"
                required>
            </div>

            <div class="form-group">
              <label for="cardHolder">{{ languageService.getTranslation('card_holder_name') }}</label>
              <input
                type="text"
                id="cardHolder"
                [(ngModel)]="cardHolder"
                name="cardHolder"
                placeholder="John Doe"
                required>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="expiryDate">{{ languageService.getTranslation('expiry_date') }}</label>
                <input
                  type="text"
                  id="expiryDate"
                  [(ngModel)]="expiryDate"
                  name="expiryDate"
                  placeholder="MM/YY"
                  (input)="formatExpiryDate()"
                  maxlength="5"
                  required>
              </div>

              <div class="form-group">
                <label for="cvv">{{ languageService.getTranslation('cvv') }}</label>
                <input
                  type="text"
                  id="cvv"
                  [(ngModel)]="cvv"
                  name="cvv"
                  placeholder="123"
                  (input)="formatCvv()"
                  maxlength="4"
                  required>
              </div>
            </div>
          </div>

          <div class="security-info">
            <i class="fas fa-shield-alt"></i>
            <div>
              <p>{{ languageService.getTranslation('donation_secure_tax_deductible') }}</p>
              <span>{{ languageService.getTranslation('all_info_confidential') }}</span>
            </div>
          </div>

          <button type="submit" class="submit-payment-btn">
            <i class="fas fa-heart"></i>
            <span>{{ languageService.getTranslation('complete_donation') }}</span>
          </button>
        </form>
      </div>
    </ng-container>

    <ng-template #successState>
      <div class="success-message">
        <div class="success-icon">
          <i class="fas fa-check-circle"></i>
        </div>
        <h2>{{ languageService.getTranslation('thank_you') }}</h2>
        <p>{{ getDonationProcessedText(donationAmount) }}</p>
        <p>{{ languageService.getTranslation('confirmation_email_shortly') }}</p>
        <div class="success-animation">
          <i class="fas fa-heart"></i>
        </div>
        <button class="back-btn" (click)="goBack()">{{ languageService.getTranslation('return_home') }}</button>
      </div>
    </ng-template>
  </div>
</section>
